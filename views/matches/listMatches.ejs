<%- include("../common/header") -%>
<div id="navbar" class="collapse navbar-collapse">
    <ul class="nav navbar-nav">
        <li><a href="/match/create">Új meccs létrehozása</a></li>
        <li><a href="/team/create">Új csapat hozzáadása</a></li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
        <%- include("../common/loginpanel") -%>
    </ul>
</div>
</div>
</nav>

<div class="container" style="margin-top: 80px">
    <div class="col-lg-offset-2 col-lg-8" style="margin-bottom: 20px;">
        <form class="form-inline" method="post" action="/matches/">
            <div class="col-lg-1"><label for="searchBox">Keresés:</label></div>
            <div class="col-lg-9" style="margin-top: -10px">
                <input type="text" class="form-control" style="width: 100%" name="keyword" placeholder="csapatnév, bajnokság neve">
            </div>
            <div class="col-lg-2"><button class="btn btn-default" type="submit">Keresés!</button></div>
        </form>
    </div>

    <% for (var i = 0; i < matches.length; i++) { var x = matches[i]; %>
    <div class="panel panel-default col-lg-8 col-lg-offset-2">
        <div class="panel-heading"><%=x.matchType %></div>
        <div class="panel-body">
            <table class="matchtable" style="width: 100%">
                <tr>
                    <td style="text-align: right; width: 42%;"><%=x.homeTeam.name %></td>
                    <td style="text-align: center; width: 16%"><%=x.homeScore%> - <%=x.awayScore%></td>
                    <td style="width: 42%;"><%=x.awayTeam.name%></td>
                </tr>
                <tr>
                    <td><%=x.stadium %>, <%= x.date %></td>
                    <td />
                    <td style="text-align:right"><%=x.referee%></td>
                </tr>
                <tr>
                    <td><%=x.spectators%> néző</td>
                    <td />
                    <td style="text-align:right">
                        <a class="btn btn-default modifyBtn" type="button" value="Módosít" href="/match/<%=x.id %>/edit">Módosít</a>
                        <input class="btn btn-danger deleteBtn" type="button" value="Törlés" data-id="<%=x.id %>" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <% } %>
</div>

<div class="modal" style="display: hidden" id="confirmdialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Megerősítés</h4>
            </div>
            <div class="modal-body">
                <p>Biztos, hogy törlöd a következő meccset?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Nem</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="yesBtn">Igen</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(".deleteBtn").click(function(obj) {
        var btn = obj.target;
        var id = $(btn).data("id");
        $("#confirmdialog").modal({show: true});
        $("#confirmdialog #yesBtn").one("click", function(evt) {
            $.ajax({
                url: "/match/" + id + "/delete",
            }).done(function() {
                alert("Sikeres törlés!");
                window.location.href = "/matches";
            }).fail(function() {
                alert("Sikertelen törlés!");
            });
        });
    });

    $(".modifyBtn").click(function() {
        var curr = $(this);
        window.location = curr.data("href");
    });
</script>
<%- include("../common/footer") -%>